version: '3.8'

services:
  foreman:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        FOREMAN_FQDN: foreman.local
    container_name: foreman
    hostname: foreman
    privileged: true
    environment:
      - FOREMAN_FQDN=foreman.local
      - DEBIAN_FRONTEND=noninteractive
    ports:
      - "443:443"    # HTTPS веб-интерфейс Foreman
      - "80:80"      # HTTP (редирект)
      - "8140:8140"  # Puppet Server
      - "8443:8443"  # Smart Proxy
    volumes:
      - foreman_postgresql:/var/lib/postgresql
      - foreman_config:/etc/foreman
      - foreman_data:/var/lib/foreman
    restart: unless-stopped
    networks:
      - foreman_network

volumes:
  foreman_postgresql:
    driver: local
  foreman_config:
    driver: local
  foreman_data:
    driver: local

networks:
  foreman_network:
    driver: bridge